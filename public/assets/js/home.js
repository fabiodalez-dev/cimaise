import"./home-gallery.js";import"./lenis-CfsBQfFC.js";var e;e=()=>{const e=document.getElementById("albums-carousel");if(!e)return;const t=e.parentElement,n=e.querySelectorAll(".album-carousel-item");if(!n.length)return;let s=0,a=0,r=!1,o=0,i=null;const l=()=>{const e=n[0],t=getComputedStyle(e);return e.offsetWidth+parseFloat(t.marginLeft)+parseFloat(t.marginRight)},d=l()*n.length,m=()=>{e.style.transform=`translate3d(${s}px, 0, 0)`},c=e=>e.type.includes("mouse")?e.clientX:e.touches[0].clientX,h=window.matchMedia&&window.matchMedia("(max-width: 767px)").matches,u=()=>{s-=.6,Math.abs(s)>=d&&(s=0),m(),i=requestAnimationFrame(u)};h||(i=requestAnimationFrame(u));const g=t=>{t.preventDefault(),t.stopPropagation(),r=!0,o=c(t),a=s,i&&(cancelAnimationFrame(i),i=null),e.classList.add("dragging"),document.body.style.userSelect="none"},p=e=>{if(!r)return;e.preventDefault(),e.stopPropagation();const t=c(e);s=a+(t-o),m()},v=()=>{const e=l()*n.length;Math.abs(s)>=e&&(s%=e),s>0&&(s=s%e-e)},b=()=>{r&&(r=!1,e.classList.remove("dragging"),document.body.style.userSelect="",v(),m(),h||setTimeout(()=>{i||(i=requestAnimationFrame(u))},1200))};e.addEventListener("mousedown",g),e.addEventListener("mousemove",p),e.addEventListener("mouseup",b),e.addEventListener("mouseleave",b),e.addEventListener("touchstart",g,{passive:!1}),e.addEventListener("touchmove",p,{passive:!1}),e.addEventListener("touchend",b),e.addEventListener("dragstart",e=>e.preventDefault()),e.addEventListener("selectstart",e=>e.preventDefault()),h||(t.addEventListener("mouseenter",()=>{i&&(cancelAnimationFrame(i),i=null)}),t.addEventListener("mouseleave",()=>{i||r||(i=requestAnimationFrame(u))}));const w=t.parentElement.querySelector(".albums-arrow-left"),y=t.parentElement.querySelector(".albums-arrow-right"),f=()=>1*l();w&&w.addEventListener("click",()=>{s+=f(),v(),m()}),y&&y.addEventListener("click",()=>{s-=f(),v(),m()})},"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e);class t{constructor(e={}){this.apiUrl=e.apiUrl||"/api/home/gallery",this.container=e.container,this.renderImage=e.renderImage,this.batchSize=e.batchSize||20,this.hasMore=!0,this.loading=!1,this.observer=null,this.shownImageIds=new Set((e.shownImageIds||[]).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)&&e>0)),this.shownAlbumIds=new Set((e.shownAlbumIds||[]).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)&&e>0))}async loadMore(){if(this.loading||!this.hasMore)return;let e,t;this.loading=!0;try{t=new AbortController,e=setTimeout(()=>t.abort(),1e4);const n=new URLSearchParams({exclude:Array.from(this.shownImageIds).join(","),excludeAlbums:Array.from(this.shownAlbumIds).join(","),limit:String(this.batchSize)}),s=await fetch(`${this.apiUrl}?${n}`,{signal:t.signal});if(!s.ok)return void(this.hasMore=!1);const a=await s.json();Array.isArray(a.images)&&a.images.forEach(e=>{const t=parseInt(e.id,10);isNaN(t)||t<=0||this.shownImageIds.has(t)||(this.renderImage&&this.renderImage(e),this.shownImageIds.add(t))}),Array.isArray(a.newAlbumIds)&&a.newAlbumIds.forEach(e=>{const t=parseInt(e,10);!isNaN(t)&&t>0&&this.shownAlbumIds.add(t)}),this.hasMore=Boolean(a.hasMore)}catch(n){this.hasMore=!1}finally{e&&clearTimeout(e),this.loading=!1}}observe(e){e&&(this.observer&&this.observer.disconnect(),this.observer=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&this.hasMore&&!this.loading&&this.loadMore()},{rootMargin:"200px"}),this.observer.observe(e))}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null)}startBackgroundLoading(){requestAnimationFrame(()=>{this.loadMore()})}hasMoreImages(){return this.hasMore}isLoading(){return this.loading}getLoadedCount(){return this.shownImageIds.size}}!function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}(()=>{const e=document.getElementById("home-infinite-gallery");if(!e)return;const n=document.querySelector(".home-mobile-wrap"),s=document.querySelector(".home-desktop-wrap"),a=()=>{n&&s&&(window.innerWidth>=768?(n.style.display="none",s.style.display="flex"):(n.style.display="block",s.style.display="none"))};a();let r=null;window.addEventListener("resize",()=>{r||(r=requestAnimationFrame(()=>{a(),r=null}))}),e.style.opacity="1",Array.from(e.querySelectorAll(".home-item")).forEach(e=>e.classList.add("home-item--revealed"));const o=window.homeLoaderConfig;if(o&&o.hasMore){const n=null!==e.closest('[data-scroll-direction="horizontal"]'),s=e.querySelector(".home-mobile"),a=n?Array.from(e.querySelectorAll(".home-track-h")):Array.from(e.querySelectorAll(".home-track"));let r=0;const i=new t({apiUrl:`${o.basePath}/api/home/gallery`,container:e,shownImageIds:o.shownImageIds,shownAlbumIds:o.shownAlbumIds,batchSize:20,renderImage:e=>{const t=function(e,t,n){var s,a,r;const o=Number.parseInt(e.width,10),i=Number.parseInt(e.height,10),l=Number.isFinite(o)&&o>0?o:1600,d=Number.isFinite(i)&&i>0?i:1067,m=e=>e&&e.length?e.map(e=>{const n=e.split(" ");return`${n[0].startsWith("/")?t+n[0]:n[0]} ${n[1]||"1x"}`}).join(", "):"",c=m(null==(s=e.sources)?void 0:s.avif),h=m(null==(a=e.sources)?void 0:a.webp),u=m(null==(r=e.sources)?void 0:r.jpg),g=e.fallback_src||e.url,p=g.startsWith("/")?t+g:g,v=`${t}/album/${encodeURIComponent(e.album_slug||"")}`,b=e.alt||e.album_title||"",w=e.album_title||"",y=document.createElement("div");y.className=n?"home-cell-h":"home-cell";const f=document.createElement("div");f.className="home-item home-item--revealed group rounded-xl overflow-hidden shadow-sm relative transition-transform hover:scale-105 duration-300",f.style.aspectRatio=`${l} / ${d}`,f.dataset.imageId=String(parseInt(e.id,10)||0);const I=document.createElement("a");I.href=v,I.className="block w-full h-full relative z-10",I.title=w;const E=document.createElement("picture");E.className="block w-full h-full";const A=(e,t)=>{if(!t)return;const n=document.createElement("source");n.type=e,n.srcset=t,n.sizes="(min-width:1024px) 50vw, (min-width:640px) 70vw, 100vw",E.appendChild(n)};A("image/avif",c),A("image/webp",h),A("image/jpeg",u);const L=document.createElement("img");L.src=p,L.alt=b,L.width=l,L.height=d,L.loading="lazy",L.decoding="async",L.className="w-full h-full object-cover block",E.appendChild(L);const S=document.createElement("div");S.className="absolute inset-0 bg-black/70 text-white flex items-center justify-center transform translate-y-full group-hover:translate-y-0 transition-transform duration-300";const N=document.createElement("span");return N.className="px-4 text-base md:text-lg lg:text-xl font-medium tracking-tight text-center",N.textContent=w,S.appendChild(N),I.appendChild(E),I.appendChild(S),f.appendChild(I),y.appendChild(f),y}(e,o.basePath,n);if(s){const e=t.cloneNode(!0);e.className="home-cell",s.appendChild(e)}a.length>0&&(a[r%a.length].appendChild(t),r++)}});i.startBackgroundLoading();const l=document.getElementById("home-load-trigger");l&&i.observe(l)}});
